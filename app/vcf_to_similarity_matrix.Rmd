---
title: "RNASeq_similarity_matrix: results"
output: 
  html_document:
    toc: true
    toc_float: true
    toc_levels: 5
    code_folding: hide
editor_options: 
  chunk_output_type: console
---

```{r}
library(ggplot2)
library(SNPRelate)
library(dplyr)
library(readr)
library(tibble)
library(tidyr)
library(stringr)

tmp=tempfile()
filename='bam_files.merged_chr1.header_withRG.MarkDuplicates.freebayes_best_4_alleles.QUAL_GT_20.common_snps_only.vcf'
snpgdsVCF2GDS(filename, 
              tmp,  
              method="biallelic.only")

genofile <- openfn.gds(tmp)

ibs <- snpgdsIBS(genofile, remove.monosnp = FALSE, missing=0.9,maf = 0.05)
colnames(ibs$ibs)=ibs$sample.id

ibs_tibble=as.tibble(ibs$ibs)%>%
  mutate(ID1=ibs$sample.id)%>%
  gather('ID2','IBS',c(-ID1))


ibs_aug=ibs_tibble %>%
  mutate(ID1=str_replace(ID1,'-','_'))%>%
  mutate(ID2=str_replace(ID2,'-','_'))


ibs_aug%>%
  ggplot()+
  aes(x=ID1, y=ID2, fill=IBS)+
  geom_raster()+
  scale_fill_viridis_c()+
  theme(axis.text.y = element_text(size=5, family = 'mono'))+
  theme(axis.text.x = element_text(angle=-90, hjust=0, vjust=0, size=5, family='mono'))+
  labs(title='Sequence Similarity Plot',
       x='',
       y='')

ggsave('rnaseq_similarity_matrix.result.pdf', width = 15,height=15,dpi=300)
write_csv(ibs_aug, 'rnaseq_similarity_matrix.result.pdf')
```


